<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mainMapper">

<!-- 고객 취향 추천 리스트 -->
<select id="selectUserStyle" parameterType="hashMap" resultType="mainDTO">
	select c.user_Id,c.user_Style,p.prod_subcode,p.prod_name,p.prod_price,pi.prod_img,r.avgscore
	from custom c,product_info p,product_img pi,
	(
		select p.prod_subcode,nvl(round(avg(r.review_score),1),0) avgscore 
	 	from review r,product p
	 	where p.prod_code=r.prod_code(+)
	 	group by p.prod_subcode
	 ) r
	where c.user_Id=#{user_Id} and c.user_Style=#{user_Style}
	and c.user_Style=p.prod_Style 
	and pi.prod_subCode=p.prod_subCode 
	and r.prod_subcode=p.prod_subcode 
	and r.prod_subcode=pi.prod_subcode 
	and pi.prod_mainImg='1'
	<![CDATA[
	and rownum<5
	]]>
</select>

</mapper>